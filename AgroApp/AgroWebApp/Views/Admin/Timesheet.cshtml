@{
    Layout = "~/views/shared/_adminlayout.cshtml";
}

<!-- Header -->
<header id="header" data-current-skin="blue" data-ng-controller="headerCtrl as hctrl">@{ await Html.RenderPartialAsync("header-image-logo");  }</header>

<section id="main" ng-controller="TimesheetController as tc" ng-cloak>
    <!-- Sidebar -->
    <aside id="sidebar" data-ng-class="{ 'toggled': mactrl.sidebarToggle.left === true }">@{ await Html.RenderPartialAsync("sidebar-left");  }</aside>
    <section id="content" ng-init="EmployeeAssignment = @ViewData["EmployeeAssignment"]; tc.getAssignment(EmployeeAssignment.Assignment.IdAssignment); tc.timesheetDetails.IdEmployeeAssignment = EmployeeAssignment.IdEmployeeAssignment">
        <div class="container">
            <div class="card">
                <div class="card-header ch-alt">
                    <div class="media-body">
                        <h2>{{tc.selectedAssignment.Customer.Name}} <small>{{tc.selectedAssignment.Date}}</small></h2>
                    </div>
                </div>
                <div class="card-body card-padding">
                    <p class="lead">{{tc.selectedAssignment.Location}}</p>
                    <p>{{tc.selectedAssignment.Description}}</p>
                </div>
            </div>

            @if (ViewData["EnableControls"] as bool? ?? false)
            {
                <div slider="showNewTaskCard">
                    <div class="card">
                        <div class="card-header ch-alt">
                            <h2>Taak Toevoegen<small>Hier kunt u uw gewerkte uren invullen</small></h2>
                        </div>
                        <div class="card-body card-padding">
                            <div class="row">
                                <div class="col-xs-12 m-b-15" ng-init="">
                                    <label>Type Werk</label>
                                    <small class="c-gray">Selecteer hier op welke manier u heeft gewerkt</small>
                                    <select chosen ng-model="tc.timesheetDetails.WorkType" data-placeholder="Mankeuze" width="'100%'" class="w-100">
                                        <option value="{{type}}" ng-repeat="type in tc.allWorkTypes">
                                            {{type}}
                                        </option>
                                    </select>
                                </div>
                                <div uib-collapse="tc.timesheetDetails.WorkType != 'Machinist'">
                                    <div class="col-sm-6 m-b-15" ng-init="tc.getAllMachines()">
                                        <label>Voertuig</label>
                                        <select chosen multiple width="'100%'" class="w-100"
                                                data-placeholder="Selecteer uw collega's"
                                                ng-model="tc.timesheetDetails.Machines"
                                                ng-options="x as x.Name for x in tc.allMachines"></select>
                                    </div>
                                    <div class="col-sm-6 m-b-15">
                                        <label>Hulpstuk</label>
                                        <select chosen multiple width="'100%'" class="w-100"
                                                data-placeholder="Hulpstuk"
                                                ng-model="tc.timesheetDetails.Attachments"
                                                ng-options="x as x.Name for x in tc.allAttachments"></select>
                                    </div>
                                </div>
                            </div>

                            <label>Tijden</label>
                            <div class="row">
                                <div class="col-sm-4">
                                    <small>Van</small>
                                    <div class="form-group fg-line">
                                        <input ng-model="tc.timesheetDetails.StartTime" type="time" class="form-control" placeholder="bv. 07:00">
                                    </div>
                                </div>

                                <div class="col-sm-4">
                                    <small>Tot</small>
                                    <div class="form-group fg-line">
                                        <input ng-model="tc.timesheetDetails.EndTime" type="time" class="form-control" placeholder="bv. 15:00">
                                    </div>
                                </div>

                                <div class="col-sm-4">
                                    <small>Totaal</small>
                                    <div class="form-group fg-line">
                                        <input ng-model="tc.timesheetDetails.TotalTime" type="time" class="form-control" ng-change="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="form-group fg-line">
                                        <label>Beschrijving</label>
                                        <textarea class="form-control" rows="6" placeholder="Beschrijving..."
                                                  ng-model="tc.timesheetDetails.Description"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body card-padding bgm-gray">
                            <button class="btn btn-primary m-r-15" ng-click="tc.addTimesheet()">Toevoegen</button>
                            <button class="btn btn-default" ng-click="showNewTaskCard = false; showTaskOverview= true" slide-toggle="#showNewTaskCard">Annuleren</button>
                        </div>
                    </div>
                </div>
            }
            @*Overzicht Taken*@
            <div slider="showTaskOverview" enabled="true">
                <div class="card">
                    <div class="card-header ch-alt m-b-15">
                        <h2>Overzicht Uren <small>Overzicht ingevulde gegevens voor deze opdracht</small></h2>
                        <button class="btn bgm-red btn-float waves-effect" ng-show="'@ViewData["EnableControls"]' == 'True'" ng-click="showNewTaskCard = true; showTaskOverview = false"><i class="zmdi zmdi-plus"></i></button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table ng-table="am.Table" class="table table-striped table-vmiddle" ng-init="tc.getAllTimesheets(EmployeeAssignment.IdEmployeeAssignment)">
                                <colgroup>
                                    <col width="100px" />
                                    <col width="25px" />
                                    <col width="25px" />
                                    <col width="25px" />
                                    <col />
                                    <col width="125px" />
                                </colgroup>
                                <tr ng-repeat="w in tc.allTimesheets">
                                    <td data-title="'Soort Werk'" sortable="'worktype'">
                                        {{ w.WorkType }}
                                    </td>
                                    <td data-title="'Van'" sortable="'start'">
                                        {{ w.StartTime | date:"HH:mm" }}
                                    </td>
                                    <td data-title="'Tot'" sortable="'end'">
                                        {{ w.EndTime | date:"HH:mm" }}
                                    </td>
                                    <td data-title="'Totaal'" sortable="'end'">
                                        {{ w.TotalTime | date:"HH:mm" }}
                                    </td>
                                    <td data-title="'Beschrijving'" sortable="'beschrijving'">
                                        {{ w.Description }}
                                    </td>
                                    <td>
                                        <button class="button btn btn-default" ng-click="am.changeAssignment()"><i class="zmdi zmdi-edit"></i></button>
                                        <a class="btn btn-default" href="~/admin/urenoverzicht/{{w.IdAssignment}}"><i class="zmdi zmdi-case"></i></a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="lv-header card-body card-padding bgm-teal c-white">
                        Totaal: 0 uur
                    </div>
                </div>
            </div>

            <div class="card" ng-init="tc.getAllUsers()">
                <div class="card-header ch-alt">
                    <h2>Collegas <small>Met welke collegas heb je gewerkt</small></h2>
                </div>

                <div class="card-body card-padding">
                    <select chosen multiple class="w-100"
                            data-placeholder="Selecteer uw collega's"
                            ng-model="tc.selectedCoworkers"
                            ng-options="x.IdEmployee as x.Name for x in tc.allUsers"></select>
                </div>
            </div>

            <div class="card">
                <div class="card-body card-padding">
                    <button class="btn bgm-blue">Opslaan</button>
                </div>
            </div>
        </div>
    </section>
</section>

@section styles{
    <link href="~/lib/chosen/chosen.css" rel="stylesheet" />
    <link href="~/lib/chosen/chosen-sprite.png" rel="image_src" />
}

@section scripts{
    <script src="~/lib/chosen/chosen.js"></script>
    <script src="~/lib/angular-chosen-localytics/dist/angular-chosen.min.js"></script>
    <script src="~/lib/angularslideables-master/angularslideables.js"></script>
    <script src="~/lib/angular-nouislider/src/nouislider.js"></script>
    <script src="~/lib/input-mask/input-mask.min.js"></script>

    <script>angular.module('materialAdmin').requires.push('localytics.directives');</script>
    <script>angular.module('materialAdmin').requires.push('angularSlideables');</script>
}